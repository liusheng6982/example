<!DOCTYPE html>
<html lang="en">
<head>
    {{template "new_head_common_js.html" .}}
    <link rel="stylesheet" type="text/css" href="/static/medicalChain/static/css/register.css">
</head>
<body>
<div class="mainPage">
    <!--头部导航部分-->
    <div class="headerShadow">
        <div class="header rowFlex">
            <div class="logo">
                <img src="/static/medicalChain/static/imgs/logo.png">
            </div>
            <div class="topRegister">账号注册</div>
        </div>
    </div>
    <!--register-->
    <form class="registerMain">
        <div class="firstRegister" id="firstRegister">
            <div class="formItem">
            <label class="registerLabel" for="comName">公司名称</label><input name="CompanyName" id="CompanyName" placeholder="请输入您的公司名称" type="text" class="registerInput"/><span class="registerTip">请填写营业执照上的名字</span>
        </div>
            <div class="formItem">
                <label class="registerLabel">用户名</label><input name="UserName" id="UserName" type="text"  class="registerInput" placeholder="请输入您的用户名"/><span class="registerTip">请填写用户姓名</span>
            </div>
            <div class="formItem">
                <label class="registerLabel">手机号码</label><input name="UserPhone" type="text" class="registerInput" placeholder="可用于登录和找回密码" /><span class="registerTip">请输入11位有效的手机号码</span>
            </div>
            <div class="formItem">
                <label class="registerLabel">密码</label><input  name="UserPassword" type="password" placeholder="请设置您的密码"  class="registerInput"/><span class="registerTip">6-20位（区分大小写）、数字、字符的组合</span>
            </div>
            <div class="formItem">
                <label class="registerLabel">确认密码</label><input  name="SecondPassword" type="password" class="registerInput" placeholder="请确认您的密码"/><span class="registerTip">请与上面的密码一致</span>
            </div>
            <div class="formItem">
                <label class="registerLabel">验证码</label><input name="VerifyCode" type="text" class="codeInput" placeholder="请填写您收到的验证码" /><input type="button" id="btn" onclick="sendemail()" class="codeBtn" value="获取短信验证码">
            </div>
            <div class="registerBtn"><input class="nextBtn" id="nextBtn" type="button" value="下一步"></div>
        </div>
        <div class="secRegister" style="display: none" id="secRegister">
            <div class="formItem">
                <label class="registerLabel">注册类型</label>
                <div class="radioModule rowFlex">
                    <label  class="radioItem radioChecked">医院<input name="company-type" type="radio" checked="checked" value="1" /></label>
                        <label  class="radioItem">供应商<input type="radio" value="2" name="company-type" /></label>
                </div>

            </div>
            <div class="formItem">
                <label class="registerLabel">三证合一</label><div class="fileModule" ><!--label for="license-img" class="fileLabel">选择文件</label--><input type="file" value="选择文件" name="license-img" id="license-img"/></div>
            </div>
            <div class="registerBtn">
                <input type="button" class="btn_left" id="prevBtn" value="上一步"/>
                <input type="button" class="btn_right" id="regBtn" value="注册" />
            </div>
        </div>
    </form>
    <!--底部footer-->
{{template "new_footer.html" .}}
</div>
<script src="/static/medicalChain/static/js/jquery-2.1.1.min.js"></script>
<script src="/static/medicalChain/static/js/bootstrap.min.js"></script>
<script src="/static/medicalChain/static/js/comm.js"></script>
<script src="/static/plugin/ajaxfileupload.js"></script>
<script>
    $(".radioItem").on("click",function(){
        var itemRadio = $(this).children("input[type='radio']");
        if(!itemRadio.is(":checked")){
            $(this).siblings("label").removeClass("radioChecked");
            $(this).addClass("radioChecked");
        }
    });
    $("#prevBtn").on("click",function(){
        $("#secRegister").css("display","none");
        $("#firstRegister").css("display","block");
    });
    $("#nextBtn").on("click",function(){
        var boj = {
            CompanyName  : $("input[name='CompanyName']").val(),
            UserPhone    : $("input[name='UserPhone']").val(),
            UserName     : $("input[name='UserName']").val(),
            VerifyCode   : $("input[name='VerifyCode']").val()
        }

        if( boj.CompanyName == "" ){
            alert("公司名称不能为空！")
            return;
        }

        if( boj.UserName == "" ){
            alert("用户名不能为空！")
            return;
        }

        if( boj.UserPhone == "" ){
            alert("手机号不能为空！")
            return;
        }

        if( $("input[name='UserPassword']").val().length < 6 ){
            alert("密码不能少于6位！")
            return;
        }

        if( $("input[name='SecondPassword']").val() !=  $("input[name='UserPassword']").val() ){
            alert("两次密码输入不一致！")
            return;
        }


        jQuery.post("/RegistryVerify",boj,function(data, textStatus, jqXHR){
            if(data.isSuccess){
                $("#firstRegister").css("display","none");
                $("#secRegister").css("display","block");
            }else{
                alert( data.msg )
                return;
            }
        },"json");


    });

    //第二页的确定按钮
    $("#regBtn").click(function(){
        //if(!verifyCheck._click()) return;
        /*
        var chk_value =[];
        $('input[name="company-type"]:checked').each(function(){
            chk_value.push($(this).val());
        });
        if( chk_value.length == 0 ){
            alert("其选择公司类型！")
            return;
        }*/

        var boj = {
            CompanyName  : $("input[name='CompanyName']").val(),
            UserName     : $("input[name='UserName']").val(),
            UserPhone    : $("input[name='UserPhone']").val(),
            UserPassword : $("input[name='UserPassword']").val(),
            VerifyCode   : $("input[name='VerifyCode']").val(),
            company_type : $("input[name='company-type']:checked").val(),
            vip_type     : $("input[name='vip-type']:checked").val()
        }

        if( boj.CompanyName == "" ){
            alert("公司名称必填！")
            return;
        }

        if( boj.UserName == "" ){
            alert("用户名不能为空！")
            return;
        }
        if( $("input[name='license-img']").val() == ''){
            alert("请上传营业执照");
            return;
        }


        $.ajaxFileUpload({
            url:"registry",
            secureuri:false,
            fileElementId:$("input[name='license-img']").attr("id"),
            dataType:'json',
            data:boj,
            type:'POST',
            success:function(data){
                if(data.regsuccess){
                    alert("注册成功！")
                    setTimeout("window.location.href='/userlogin'",1000)
                }
                else {
                    alert(data.msg)
                }
            },
            error:function(data){
                alert("error"+data.msg);
            }
        });
        //$(".part3").show();
    });


    var countdown=60;
    function sendemail() {
        countdown = 60;
        console.log("adfasdfasdfasdf");
        if( $("input[name='UserPhone']").val() == '' ){
            alert("请你输入手机号！")
            return;
        }
        $.post("/sendSms", {"UserPone": $("input[name='UserPhone']").val()},
                function (data, textStatus, jqXHR) {
                    if( data.success ){
                        var obj = $("#btn");
                        settime(obj);
                    }
                },
                "json");
    }

    function settime(obj) { //发送验证码倒计时
        if (countdown == 0) {
            obj.attr('disabled',false);
            //obj.removeattr("disabled");
            obj.val("获取短信验证码");
            countdown = 60;
            return;
        } else {
            obj.attr('disabled',true);
            obj.val("重新发送(" + countdown + ")");
            countdown--;
        }
        setTimeout(function() {
                    settime(obj) }
                ,1000)
    }
</script>
</body>
</html>